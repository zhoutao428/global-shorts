export default class DiscoverPage{constructor(e){this.params=e,this.currentTab="recommended",this.currentCategory="all",this.page=1,this.isLoading=!1,this.hasMore=!0,this.init()}init(){console.log("Discover page initialized",this.params),this.initTabs(),this.initCategories(),this.initInfiniteScroll(),this.loadContent(),this.bindEvents()}initTabs(){const e=document.querySelectorAll(".discover-tab");e.forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.tab;e.forEach(e=>e.classList.remove("active")),t.classList.add("active"),this.currentTab=n,this.page=1,this.hasMore=!0,document.getElementById("contentGrid").innerHTML="",this.loadContent()})})}initCategories(){const e=document.querySelectorAll(".category-chip");e.forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.category;e.forEach(e=>e.classList.remove("active")),t.classList.add("active"),this.currentCategory=n,this.page=1,this.hasMore=!0,document.getElementById("contentGrid").innerHTML="",this.loadContent()})})}initInfiniteScroll(){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!this.isLoading&&this.hasMore&&(this.page++,this.loadContent())})},{root:null,rootMargin:"0px",threshold:.1}),t=document.getElementById("loadMoreTrigger");t&&e.observe(t)}async loadContent(){if(!this.isLoading&&this.hasMore){this.isLoading=!0,this.showLoading();try{const e=new URLSearchParams({page:this.page,limit:20,tab:this.currentTab,category:"all"!==this.currentCategory?this.currentCategory:""}),t=await fetch(`/api/discover?${e}`),n=await t.json();n.success&&(this.renderContent(n.data),this.hasMore=n.pagination.page<n.pagination.pages)}catch(e){console.error("Failed to load content:",e),this.showError("Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}finally{this.isLoading=!1,this.hideLoading()}}}renderContent(e){const t=document.getElementById("contentGrid");e.forEach(e=>{const n=this.createContentCard(e);t.appendChild(n)}),this.updateLoadMoreTrigger()}createContentCard(e){const t=document.createElement("div");return t.className="content-card",t.dataset.id=e.id,t.innerHTML=`\n            <div class="card-thumbnail">\n                <img src="${e.coverImage||"/images/placeholder.jpg"}" alt="${e.title}">\n                <div class="card-badges">\n                    ${e.isHot?'<div class="badge hot">HOT</div>':""}\n                    ${e.isNew?'<div class="badge new">NEW</div>':""}\n                    ${e.rating?`<div class="badge rating">‚≠ê ${e.rating}</div>`:""}\n                </div>\n                <div class="card-overlay">\n                    <button class="play-btn" onclick="event.stopPropagation()">\n                        <i class="fas fa-play"></i>\n                    </button>\n                </div>\n            </div>\n            <div class="card-info">\n                <h3 class="card-title">${e.title}</h3>\n                <div class="card-meta">\n                    <span class="category">${this.getCategoryName(e.category)}</span>\n                    <span class="views">üëÅ ${this.formatViews(e.viewCount)}</span>\n                </div>\n                <p class="card-description">${e.description||""}</p>\n                <div class="card-tags">\n                    ${e.tags?e.tags.map(e=>`<span class="tag">#${e}</span>`).join(""):""}\n                </div>\n            </div>\n        `,t.addEventListener("click",()=>{window.router.navigate(`/player/${e.id}`)}),t.querySelector(".play-btn").addEventListener("click",t=>{t.stopPropagation(),window.router.navigate(`/player/${e.id}`)}),t}getCategoryName(e){return{romance:"Áà±ÊÉÖ",ceo:"ÊÄªË£Å",fantasy:"ÁéÑÂπª",suspense:"ÊÇ¨Áñë",comedy:"ÂñúÂâß",action:"Âä®‰Ωú",historical:"Âè§Ë£Ö"}[e]||e}formatViews(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}updateLoadMoreTrigger(){let e=document.getElementById("loadMoreTrigger");e||(e=document.createElement("div"),e.id="loadMoreTrigger",e.className="load-more-trigger",document.getElementById("contentGrid").after(e)),this.hasMore?e.innerHTML="":e.innerHTML='<p class="end-message">Ê≤°ÊúâÊõ¥Â§ö‰∫Ü</p>'}showLoading(){const e=document.getElementById("contentLoading");e&&e.classList.add("show")}hideLoading(){const e=document.getElementById("contentLoading");e&&e.classList.remove("show")}showError(e){const t=new CustomEvent("showToast",{detail:{message:e,type:"error"}});document.dispatchEvent(t)}bindEvents(){const e=document.getElementById("discoverSearch"),t=document.getElementById("searchBtn");if(e&&t){const n=()=>{const t=e.value.trim();t&&window.router.navigate("/search",{q:t})};t.addEventListener("click",n),e.addEventListener("keypress",e=>{"Enter"===e.key&&n()})}document.querySelectorAll(".trending-tag").forEach(e=>{e.addEventListener("click",()=>{const t=e.textContent.replace("#","");window.router.navigate("/search",{q:t})})})}destroy(){console.log("Discover page destroyed")}}