const BASE_URL="";class Router{constructor(){this.routes={"/":"home","/home":"home","/player":"player","/profile":"profile","/payment":"payment","/login":"login","/discover":"discover","/404":"notfound"},this.currentPage=null,this.params={},this.beforeEach=null,this.afterEach=null,this.init()}init(){window.addEventListener("popstate",t=>{this.handleRoute()}),this.interceptLinks(),this.handleRoute()}interceptLinks(){document.addEventListener("click",t=>{const e=t.target.closest("a");if(!e)return;const a=e.getAttribute("href");a&&(a.startsWith("http")||a.startsWith("#")||(t.preventDefault(),this.navigate(a)))})}handleRoute(){let t=window.location.pathname;const e=new URLSearchParams(window.location.search);this.params={};for(let[t,a]of e)this.params[t]=a;"/"!==t&&"/index.html"!==t||(t="/");const a=this.matchRoute(t);a?this.loadPage(a,t):this.loadPage("404",t)}matchRoute(t){const e=t.replace(/^\/global-shorts/,"")||"/";if(this.routes[e])return this.routes[e];const a=e.split("/").filter(t=>t);if(a.length>=2){const t=`/${a[0]}`;if(this.routes[t])return this.params.id=a[1],this.routes[t]}return null}async loadPage(t,e){try{if(this.beforeEach&&!1===await this.beforeEach(t,this.params))return;this.showLoading();const e=await this.fetchPage(t);document.getElementById("app").innerHTML=e,this.updateTitle(t),await this.loadPageScript(t),this.currentPage=t,this.hideLoading(),this.afterEach&&this.afterEach(t,this.params),this.updateActiveNav()}catch(t){console.error("Failed to load page:",t),this.showError("页面加载失败")}}async fetchPage(t){const e=await fetch(`/src/pages/${t}.html`);if(!e.ok)throw new Error("Page not found");return e.text()}async loadPageScript(t){try{const e=await import(`/src/scripts/pages/${t}.js`);e.default&&(window[`${t}Page`]=new e.default(this.params))}catch(e){console.warn(`No script for page: ${t}`)}}updateTitle(t){document.title={home:"Global Shorts - 首页",player:"Global Shorts - 播放器",profile:"Global Shorts - 个人中心",payment:"Global Shorts - 充值中心",login:"Global Shorts - 登录",discover:"Global Shorts - 发现",notfound:"Global Shorts - 页面未找到"}[t]||"Global Shorts"}updateActiveNav(){document.querySelectorAll(".nav-item").forEach(t=>{t.classList.remove("active")});const t=document.querySelector(`.nav-item[data-page="${this.currentPage}"]`);t&&t.classList.add("active")}navigate(t,e={}){let a=t;Object.keys(e).length>0&&(a+=`?${new URLSearchParams(e).toString()}`),history.pushState({},"",a),this.handleRoute()}replace(t,e={}){let a=t;Object.keys(e).length>0&&(a+=`?${new URLSearchParams(e).toString()}`),history.replaceState({},"",a),this.handleRoute()}back(){history.back()}forward(){history.forward()}setBeforeEach(t){this.beforeEach=t}setAfterEach(t){this.afterEach=t}showLoading(){let t=document.getElementById("page-loading");t||(t=document.createElement("div"),t.id="page-loading",t.className="page-loading",t.innerHTML='<div class="loading-spinner"></div>',document.body.appendChild(t)),t.classList.add("show")}hideLoading(){const t=document.getElementById("page-loading");t&&t.classList.remove("show")}showError(t){const e=document.createElement("div");e.className="error-toast",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}getCurrentPage(){return this.currentPage}getParams(){return{...this.params}}getQueryParams(){const t=new URLSearchParams(window.location.search),e={};for(let[a,o]of t)e[a]=o;return e}}const router=new Router;export default router;