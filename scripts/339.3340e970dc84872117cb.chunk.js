/*! For license information please see 339.3340e970dc84872117cb.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkglobalshorts_frontend=self.webpackChunkglobalshorts_frontend||[]).push([[339],{339(e,n,t){function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(){var e,n,t="function"==typeof Symbol?Symbol:{},a=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function c(t,a,r,o){var c=a&&a.prototype instanceof d?a:d,l=Object.create(c.prototype);return i(l,"_invoke",function(t,a,r){var i,o,c,d=0,l=r||[],u=!1,v={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(n,t){return i=n,o=0,c=e,v.n=t,s}};function h(t,a){for(o=t,c=a,n=0;!u&&d&&!r&&n<l.length;n++){var r,i=l[n],h=v.p,f=i[2];t>3?(r=f===a)&&(c=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=h&&((r=t<2&&h<i[1])?(o=0,v.v=a,v.n=i[1]):h<f&&(r=t<3||i[0]>a||a>f)&&(i[4]=t,i[5]=a,v.n=f,o=0))}if(r||t>1)return s;throw u=!0,a}return function(r,l,f){if(d>1)throw TypeError("Generator is already running");for(u&&1===l&&h(l,f),o=l,c=f;(n=o<2?e:c)||!u;){i||(o?o<3?(o>1&&(v.n=-1),h(o,c)):v.n=c:v.v=c);try{if(d=2,i){if(o||(r="next"),n=i[r]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,o<2&&(o=0)}else 1===o&&(n=i.return)&&n.call(i),o<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),o=1);i=e}else if((n=(u=v.n<0)?c:t.call(a,v))!==s)break}catch(n){i=e,o=1,c=n}finally{d=1}}return{value:n,done:u}}}(t,r,o),!0),l}var s={};function d(){}function l(){}function u(){}n=Object.getPrototypeOf;var v=[][a]?n(n([][a]())):(i(n={},a,function(){return this}),n),h=u.prototype=d.prototype=Object.create(v);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,i(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=u,i(h,"constructor",u),i(u,"constructor",l),l.displayName="GeneratorFunction",i(u,o,"GeneratorFunction"),i(h),i(h,o,"Generator"),i(h,a,function(){return this}),i(h,"toString",function(){return"[object Generator]"}),(r=function(){return{w:c,m:f}})()}function i(e,n,t,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}i=function(e,n,t,a){function o(n,t){i(e,n,function(e){return this._invoke(n,t,e)})}n?r?r(e,n,{value:t,enumerable:!a,configurable:!a,writable:!a}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},i(e,n,t,a)}function o(e,n,t,a,r,i,o){try{var c=e[i](o),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(a,r)}function c(e){return function(){var n=this,t=arguments;return new Promise(function(a,r){var i=e.apply(n,t);function c(e){o(i,a,r,c,s,"next",e)}function s(e){o(i,a,r,c,s,"throw",e)}c(void 0)})}}function s(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d(a.key),a)}}function d(e){var n=function(e){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=a(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(n)?n:n+""}t.r(n),t.d(n,{default:()=>l});var l=function(){return e=function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=n,this.currentCategory="all",this.searchQuery="",this.page=1,this.isLoading=!1,this.hasMore=!0,this.init()},n=[{key:"init",value:function(){console.log("Home page initialized",this.params),this.initCategoryTabs(),this.initSearch(),this.initInfiniteScroll(),this.loadDramas(),this.bindEvents()}},{key:"initCategoryTabs",value:function(){var e=this,n=document.querySelectorAll(".category-item");n.forEach(function(t){t.addEventListener("click",function(){var a=t.dataset.category;n.forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"),e.currentCategory=a,e.page=1,e.hasMore=!0,document.getElementById("dramaGrid").innerHTML="",e.loadDramas()})})}},{key:"initSearch",value:function(){var e=this,n=document.getElementById("searchInput"),t=document.getElementById("searchBtn");if(n&&t){var a=function(){var t=n.value.trim();t!==e.searchQuery&&(e.searchQuery=t,e.page=1,e.hasMore=!0,document.getElementById("dramaGrid").innerHTML="",e.loadDramas())};t.addEventListener("click",a),n.addEventListener("keypress",function(e){"Enter"===e.key&&a()})}}},{key:"initInfiniteScroll",value:function(){var e=this,n=new IntersectionObserver(function(n){n.forEach(function(n){n.isIntersecting&&!e.isLoading&&e.hasMore&&(e.page++,e.loadDramas())})},{root:null,rootMargin:"0px",threshold:.1}),t=document.getElementById("loadMoreTrigger");t&&n.observe(t)}},{key:"loadDramas",value:(i=c(r().m(function e(){var n,t,a,i;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isLoading&&this.hasMore){e.n=1;break}return e.a(2);case 1:return this.isLoading=!0,this.showLoading(),e.p=2,n=new URLSearchParams({page:this.page,limit:20,category:"all"!==this.currentCategory?this.currentCategory:"",search:this.searchQuery}),e.n=3,fetch("http://localhost:3001/dramas?".concat(n));case 3:return t=e.v,e.n=4,t.json();case 4:(a=e.v).success&&(this.renderDramas(a.data),this.hasMore=a.pagination.page<a.pagination.pages),e.n=6;break;case 5:e.p=5,i=e.v,console.error("Failed to load dramas:",i),this.showError("加载失败，请重试");case 6:return e.p=6,this.isLoading=!1,this.hideLoading(),e.f(6);case 7:return e.a(2)}},e,this,[[2,5,6,7]])})),function(){return i.apply(this,arguments)})},{key:"renderDramas",value:function(e){var n=this,t=document.getElementById("dramaGrid");e.forEach(function(e){var a=n.createDramaCard(e);t.appendChild(a)}),this.updateLoadMoreTrigger()}},{key:"createDramaCard",value:function(e){var n=document.createElement("div");n.className="drama-card",n.dataset.id=e.id;var t=e.watchedEpisodes?e.watchedEpisodes/e.totalEpisodes*100:0;return n.innerHTML='\n            <div class="drama-thumbnail">\n                <div class="drama-thumbnail" style="background: linear-gradient(135deg, #FF385C, #6B46C1); display: flex; align-items: center; justify-content: center;">\n    <i class="fas fa-film" style="font-size: 48px; color: white; opacity: 0.8;"></i>\n</div>\n                <div class="drama-badges">\n                    '.concat(e.isHot?'<div class="badge hot-badge">HOT</div>':"","\n                    ").concat(e.isNew?'<div class="badge new-badge">NEW</div>':"","\n                    ").concat(e.isVip?'<div class="badge vip-only">VIP</div>':"",'\n                </div>\n                <div class="play-overlay">\n                    <div class="play-circle">\n                        <i class="fas fa-play"></i>\n                    </div>\n                </div>\n            </div>\n            <div class="drama-info">\n                <h3 class="drama-title">').concat(e.title,'</h3>\n                <div class="drama-meta">\n                    <div class="drama-episodes">\n                        <i class="fas fa-list-ol"></i>\n                        <span>').concat(e.totalEpisodes,'集</span>\n                    </div>\n                    <div class="drama-stats">\n                        <i class="fas fa-eye"></i>\n                        <span>').concat(this.formatViews(e.viewCount),"</span>\n                    </div>\n                </div>\n                ").concat(e.watchedEpisodes?'\n                <div class="progress-container">\n                    <div class="progress" style="width: '.concat(t,'%"></div>\n                </div>\n                <div class="progress-text">\n                    <span>已观看 ').concat(e.watchedEpisodes,"/").concat(e.totalEpisodes,"</span>\n                    <span>").concat(Math.round(t),"%</span>\n                </div>\n                "):"","\n            </div>\n        "),n.addEventListener("click",function(){window.router.navigate("/player/".concat(e.id))}),n}},{key:"formatViews",value:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}},{key:"updateLoadMoreTrigger",value:function(){var e=document.getElementById("loadMoreTrigger");e||((e=document.createElement("div")).id="loadMoreTrigger",e.className="load-more-trigger",document.getElementById("dramaGrid").after(e)),this.hasMore?e.innerHTML="":e.innerHTML='<p class="end-message">没有更多了</p>'}},{key:"showLoading",value:function(){var e=document.getElementById("dramaLoading");e&&e.classList.add("show")}},{key:"hideLoading",value:function(){var e=document.getElementById("dramaLoading");e&&e.classList.remove("show")}},{key:"showError",value:function(e){var n=new CustomEvent("showToast",{detail:{message:e,type:"error"}});document.dispatchEvent(n)}},{key:"bindEvents",value:function(){var e,n,t,a=this;null===(e=document.getElementById("userAvatar"))||void 0===e||e.addEventListener("click",function(){window.auth.isLoggedIn()?window.router.navigate("/profile"):window.router.navigate("/login")}),null===(n=document.getElementById("coinDisplay"))||void 0===n||n.addEventListener("click",function(){window.router.navigate("/payment")}),null===(t=document.getElementById("dailyCheckinBtn"))||void 0===t||t.addEventListener("click",function(){window.auth.isLoggedIn()?a.showCheckinModal():window.router.navigate("/login",{redirect:"home"})}),document.querySelectorAll(".nav-item").forEach(function(e){e.addEventListener("click",function(n){n.preventDefault();var t=e.dataset.page;t&&"home"!==t&&window.router.navigate("/".concat(t))})})}},{key:"showCheckinModal",value:function(){var e=this;t.e(680).then(t.bind(t,680)).then(function(n){new n.default({title:"每日签到",content:e.renderCheckinContent(),onConfirm:function(){return e.handleCheckin()}}).show()})}},{key:"renderCheckinContent",value:function(){return'\n            <div class="checkin-calendar">\n                <div class="checkin-grid">\n                    <div class="checkin-day claimed">1 <span>+10</span></div>\n                    <div class="checkin-day claimed">2 <span>+15</span></div>\n                    <div class="checkin-day claimed">3 <span>+20</span></div>\n                    <div class="checkin-day claimed">4 <span>+25</span></div>\n                    <div class="checkin-day today">5 <span>+30</span></div>\n                    <div class="checkin-day">6 <span>+40</span></div>\n                    <div class="checkin-day">7 <span>+50</span></div>\n                </div>\n                <p class="checkin-info">连续签到可获得额外奖励</p>\n            </div>\n        '}},{key:"handleCheckin",value:(a=c(r().m(function e(){var n,t,a,i,o;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/user/checkin",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 1:return n=e.v,e.n=2,n.json();case 2:(t=e.v).success&&((a=document.querySelector(".coin-display span"))&&(a.textContent=t.newBalance),i=new CustomEvent("showToast",{detail:{message:"签到成功！获得".concat(t.reward,"金币"),type:"success"}}),document.dispatchEvent(i)),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Checkin failed:",o);case 4:return e.a(2)}},e,null,[[0,3]])})),function(){return a.apply(this,arguments)})},{key:"destroy",value:function(){console.log("Home page destroyed")}}],n&&s(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,a,i}()}}]);