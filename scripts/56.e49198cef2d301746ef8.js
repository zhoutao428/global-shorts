/*! For license information please see 56.e49198cef2d301746ef8.js.LICENSE.txt */
"use strict";(self.webpackChunkglobalshorts_frontend=self.webpackChunkglobalshorts_frontend||[]).push([[56],{675(e,t,n){function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,a,o,i){var c=a&&a.prototype instanceof u?a:u,l=Object.create(c.prototype);return s(l,"_invoke",function(n,a,o){var i,c,s,u=0,l=o||[],d=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,n){return i=t,c=0,s=e,p.n=n,r}};function y(n,a){for(c=n,s=a,t=0;!d&&u&&!o&&t<l.length;t++){var o,i=l[t],y=p.p,v=i[2];n>3?(o=v===a)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=y&&((o=n<2&&y<i[1])?(c=0,p.v=a,p.n=i[1]):y<v&&(o=n<3||i[0]>a||a>v)&&(i[4]=n,i[5]=a,p.n=v,c=0))}if(o||n>1)return r;throw d=!0,a}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&y(l,v),c=l,s=v;(t=c<2?e:s)||!d;){i||(c?c<3?(c>1&&(p.n=-1),y(c,s)):p.n=s:p.v=s);try{if(u=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(d=p.n<0)?s:n.call(a,p))!==r)break}catch(t){i=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,i),!0),l}var r={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var p=[][a]?t(t([][a]())):(s(t={},a,function(){return this}),t),y=d.prototype=u.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=d,s(y,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,o,"GeneratorFunction"),s(y),s(y,o,"Generator"),s(y,a,function(){return this}),s(y,"toString",function(){return"[object Generator]"}),(c=function(){return{w:i,m:v}})()}function s(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}s=function(e,t,n,a){function i(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},s(e,t,n,a)}function u(e,t,n,a,o,i,r){try{var c=e[i](r),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(a,o)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function r(e){u(i,a,o,r,c,"next",e)}function c(e){u(i,a,o,r,c,"throw",e)}r(void 0)})}}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,p(a.key),a)}}function p(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}n.r(t),n.d(t,{default:()=>y});var y=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.activeTab=t.tab||"coins",this.selectedPackage=null,this.selectedPaymentMethod="card",this.promoCode=null,this.discount=0,this.init()},t=[{key:"init",value:(y=l(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:if(console.log("Payment page initialized",this.params),window.auth.isLoggedIn()){e.n=1;break}return window.router.navigate("/login",{redirect:"payment"}),e.a(2);case 1:return this.showLoading(),this.initTabs(),e.n=2,this.loadCoinPackages();case 2:return e.n=3,this.loadVipPlans();case 3:return e.n=4,this.loadTransactionHistory();case 4:this.bindEvents(),this.hideLoading(),"coins"!==this.activeTab&&this.switchTab(this.activeTab);case 5:return e.a(2)}},e,this)})),function(){return y.apply(this,arguments)})},{key:"initTabs",value:function(){var e=this;document.querySelectorAll(".payment-tab").forEach(function(t){t.addEventListener("click",function(){var n=t.dataset.tab;e.switchTab(n)})})}},{key:"switchTab",value:function(e){this.activeTab=e,document.querySelectorAll(".payment-tab").forEach(function(t){t.dataset.tab===e?t.classList.add("active"):t.classList.remove("active")}),document.querySelectorAll(".tab-content").forEach(function(t){t.id==="".concat(e,"Tab")?t.classList.add("active"):t.classList.remove("active")});var t=new URL(window.location);t.searchParams.set("tab",e),window.history.replaceState({},"",t)}},{key:"loadCoinPackages",value:(p=l(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:try{this.coinPackages=[{id:1,coins:100,price:.99,bonus:0,popular:!1,originalPrice:.99},{id:2,coins:500,price:4.99,bonus:50,popular:!1,originalPrice:4.99,discount:0},{id:3,coins:1200,price:9.99,bonus:200,popular:!0,originalPrice:11.99,discount:17},{id:4,coins:2500,price:19.99,bonus:500,popular:!1,originalPrice:24.99,discount:20},{id:5,coins:6500,price:49.99,bonus:1500,popular:!1,originalPrice:64.99,discount:23},{id:6,coins:14e3,price:99.99,bonus:4e3,popular:!1,originalPrice:139.99,discount:29}],this.renderCoinPackages()}catch(e){console.error("Failed to load coin packages:",e),this.showError("加载套餐失败")}case 1:return e.a(2)}},e,this)})),function(){return p.apply(this,arguments)})},{key:"renderCoinPackages",value:function(){var e=document.getElementById("coinPackages");e&&(e.innerHTML="",this.coinPackages.forEach(function(t){var n=document.createElement("div");n.className="package-card",t.popular&&n.classList.add("popular"),n.innerHTML="\n                ".concat(t.popular?'<div class="popular-badge">最受欢迎</div>':"",'\n                <div class="package-icon">\n                    <i class="fas fa-coins"></i>\n                </div>\n                <div class="package-amount">').concat(t.coins.toLocaleString()," 金币</div>\n                ").concat(t.bonus>0?'<div class="package-bonus">+ '.concat(t.bonus," 额外赠送</div>"):"",'\n                <div class="package-price">\n                    ').concat(t.discount?'<span class="original-price">$'.concat(t.originalPrice.toFixed(2),"</span>"):"",'\n                    <span class="current-price">$').concat(t.price.toFixed(2),"</span>\n                </div>\n                ").concat(t.discount?'<div class="package-discount">节省 '.concat(t.discount,"%</div>"):"",'\n                <button class="buy-btn" data-package=\'').concat(JSON.stringify(t),"'>\n                    立即购买\n                </button>\n            "),e.appendChild(n)}))}},{key:"loadVipPlans",value:(u=l(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:try{this.vipPlans=[{id:1,name:"月度VIP",duration:30,price:9.99,originalPrice:9.99,discount:0,popular:!1,features:["无广告观看","独家内容访问","高清画质","提前观看新剧集"]},{id:2,name:"季度VIP",duration:90,price:24.99,originalPrice:29.97,discount:17,popular:!0,features:["所有月度VIP权益","额外20%金币奖励","专属客服","生日礼物"]},{id:3,name:"年度VIP",duration:365,price:79.99,originalPrice:119.88,discount:33,popular:!1,features:["所有季度VIP权益","专属VIP徽章","线下活动优先权","年度会员礼盒"]}],this.renderVipPlans()}catch(e){console.error("Failed to load VIP plans:",e),this.showError("加载VIP套餐失败")}case 1:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})},{key:"renderVipPlans",value:function(){var e=document.getElementById("vipPackages");e&&(e.innerHTML="",this.vipPlans.forEach(function(t){var n=document.createElement("div");n.className="vip-card",t.popular&&n.classList.add("popular"),n.innerHTML="\n                ".concat(t.popular?'<div class="popular-badge">最受欢迎</div>':"",'\n                <div class="vip-icon">\n                    <i class="fas fa-crown"></i>\n                </div>\n                <h3 class="vip-name">').concat(t.name,'</h3>\n                <div class="vip-duration">').concat(t.duration,'天</div>\n                <div class="vip-price">\n                    ').concat(t.discount?'<span class="original-price">$'.concat(t.originalPrice.toFixed(2),"</span>"):"",'\n                    <span class="current-price">$').concat(t.price.toFixed(2),"</span>\n                </div>\n                ").concat(t.discount?'<div class="vip-discount">节省 '.concat(t.discount,"%</div>"):"",'\n                <ul class="vip-features">\n                    ').concat(t.features.map(function(e){return'<li><i class="fas fa-check"></i> '.concat(e,"</li>")}).join(""),'\n                </ul>\n                <button class="buy-vip-btn" data-plan=\'').concat(JSON.stringify(t),"'>\n                    立即开通\n                </button>\n            "),e.appendChild(n)}))}},{key:"loadTransactionHistory",value:(s=l(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:try{this.transactions=[{id:1,type:"purchase",item:"1200金币套餐",amount:9.99,status:"success",date:"2024-03-15 14:30",paymentMethod:"信用卡"},{id:2,type:"subscription",item:"月度VIP",amount:9.99,status:"success",date:"2024-03-01 10:15",paymentMethod:"PayPal"},{id:3,type:"purchase",item:"500金币套餐",amount:4.99,status:"pending",date:"2024-02-28 16:45",paymentMethod:"Google Pay"},{id:4,type:"purchase",item:"2500金币套餐",amount:19.99,status:"success",date:"2024-02-20 11:20",paymentMethod:"信用卡"},{id:5,type:"subscription",item:"季度VIP",amount:24.99,status:"success",date:"2024-02-01 09:30",paymentMethod:"PayPal"}],this.renderTransactionHistory()}catch(e){console.error("Failed to load transactions:",e)}case 1:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"renderTransactionHistory",value:function(){var e=this,t=document.getElementById("transactionHistory");t&&(0!==this.transactions.length?(t.innerHTML="",this.transactions.forEach(function(n){var a=document.createElement("div");a.className="history-item";var o="success"===n.status?"success":"pending"===n.status?"pending":"failed";a.innerHTML='\n                <div class="history-info">\n                    <div class="history-icon '.concat(o,'">\n                        <i class="fas ').concat(e.getStatusIcon(n.status),'"></i>\n                    </div>\n                    <div class="history-details">\n                        <h4>').concat(n.item,"</h4>\n                        <p>").concat(n.date," · ").concat(n.paymentMethod,'</p>\n                    </div>\n                </div>\n                <div class="history-amount ').concat(o,'">\n                    $').concat(n.amount.toFixed(2),"\n                </div>\n            "),t.appendChild(a)})):t.innerHTML='\n                <div class="empty-state">\n                    <i class="fas fa-receipt"></i>\n                    <h4>暂无交易记录</h4>\n                    <p>完成首次购买后记录将显示在这里</p>\n                </div>\n            ')}},{key:"getStatusIcon",value:function(e){return{success:"fa-check-circle",pending:"fa-clock",failed:"fa-exclamation-circle",refunded:"fa-undo"}[e]||"fa-circle"}},{key:"bindEvents",value:function(){var e,t,n,a,o,i=this;document.querySelectorAll(".method-card").forEach(function(e){e.addEventListener("click",function(){document.querySelectorAll(".method-card").forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),i.selectedPaymentMethod=e.dataset.method})}),document.addEventListener("click",function(e){var t=e.target.closest(".buy-btn");if(t){var n=JSON.parse(t.dataset.package);i.selectCoinPackage(n)}var a=e.target.closest(".buy-vip-btn");if(a){var o=JSON.parse(a.dataset.plan);i.selectVipPlan(o)}}),null===(e=document.getElementById("paymentForm"))||void 0===e||e.addEventListener("submit",function(e){e.preventDefault(),i.processPayment()}),null===(t=document.getElementById("applyPromoBtn"))||void 0===t||t.addEventListener("click",function(){i.applyPromoCode()}),null===(n=document.getElementById("promoCode"))||void 0===n||n.addEventListener("keypress",function(e){"Enter"===e.key&&i.applyPromoCode()}),null===(a=document.getElementById("viewAllTransactions"))||void 0===a||a.addEventListener("click",function(){i.switchTab("history")}),null===(o=document.getElementById("backBtn"))||void 0===o||o.addEventListener("click",function(){window.history.back()})}},{key:"selectCoinPackage",value:function(e){this.selectedPackage=i({type:"coins"},e);var t=this.applyDiscount(e.price);this.updatePayButton("支付 $".concat(t.toFixed(2))),document.getElementById("paymentFormSection").scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".package-card").forEach(function(e){e.style.borderColor=""}),event.currentTarget.closest(".package-card").style.borderColor="var(--primary)"}},{key:"selectVipPlan",value:function(e){this.selectedPackage=i({type:"vip"},e);var t=this.applyDiscount(e.price);this.updatePayButton("支付 $".concat(t.toFixed(2))),document.getElementById("paymentFormSection").scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".vip-card").forEach(function(e){e.style.borderColor=""}),event.currentTarget.closest(".vip-card").style.borderColor="var(--primary)"}},{key:"applyDiscount",value:function(e){return this.discount>0?e*(1-this.discount/100):e}},{key:"updatePayButton",value:function(e){var t=document.getElementById("payNowBtn");t&&(t.innerHTML='<i class="fas fa-lock"></i> '.concat(e),t.disabled=!1)}},{key:"applyPromoCode",value:(r=l(c().m(function e(){var t,n,a,o;return c().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("promoCode"),n=t.value.trim().toUpperCase()){e.n=1;break}return this.showError("请输入优惠码"),e.a(2);case 1:(a={WELCOME10:10,VIP20:20,SAVE30:30,COIN50:50})[n]?(this.discount=a[n],t.style.borderColor="var(--success)",this.showToast("优惠码应用成功！获得".concat(this.discount,"%折扣")),this.selectedPackage&&(o=this.applyDiscount(this.selectedPackage.price),this.updatePayButton("支付 $".concat(o.toFixed(2))))):(t.style.borderColor="var(--error)",this.showError("无效的优惠码"));case 2:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"processPayment",value:(o=l(c().m(function e(){var t,n,a,o,i,r,s,u,l,d,p,y,v=this;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.selectedPackage){e.n=1;break}return this.showError("请先选择套餐"),e.a(2);case 1:if((r={cardNumber:null===(t=document.getElementById("cardNumber"))||void 0===t?void 0:t.value.replace(/\s/g,""),cardName:null===(n=document.getElementById("cardName"))||void 0===n?void 0:n.value,expiry:null===(a=document.getElementById("expiry"))||void 0===a?void 0:a.value,cvv:null===(o=document.getElementById("cvv"))||void 0===o?void 0:o.value,email:null===(i=document.getElementById("email"))||void 0===i?void 0:i.value}).cardNumber&&r.cardName&&r.expiry&&r.cvv){e.n=2;break}return this.showError("请填写完整的支付信息"),e.a(2);case 2:return s=document.getElementById("payNowBtn"),u=s.innerHTML,s.innerHTML='<i class="fas fa-spinner fa-spin"></i> 处理中...',s.disabled=!0,e.p=3,e.n=4,new Promise(function(e){return setTimeout(e,2e3)});case 4:if(!(Math.random()>.1)){e.n=8;break}if(l=this.applyDiscount(this.selectedPackage.price),d={id:Date.now(),type:"coins"===this.selectedPackage.type?"purchase":"subscription",item:"coins"===this.selectedPackage.type?"".concat(this.selectedPackage.coins,"金币套餐"):this.selectedPackage.name,amount:l,status:"success",date:(new Date).toLocaleString(),paymentMethod:"card"===this.selectedPaymentMethod?"信用卡":this.selectedPaymentMethod},this.transactions.unshift(d),this.renderTransactionHistory(),"coins"!==this.selectedPackage.type){e.n=6;break}return p=this.selectedPackage.coins+(this.selectedPackage.bonus||0),e.n=5,this.updateUserCoins(p);case 5:e.n=7;break;case 6:return e.n=7,this.updateVipStatus(this.selectedPackage);case 7:this.showToast("支付成功！"),this.resetPaymentForm(),setTimeout(function(){"vip"===v.selectedPackage.type&&window.router.navigate("/profile?tab=vip")},3e3),e.n=9;break;case 8:throw new Error("Payment failed");case 9:e.n=11;break;case 10:e.p=10,y=e.v,console.error("Payment failed:",y),this.showError("支付失败，请重试"),s.innerHTML=u,s.disabled=!1;case 11:return e.a(2)}},e,this,[[3,10]])})),function(){return o.apply(this,arguments)})},{key:"updateUserCoins",value:(a=l(c().m(function e(t){var n,a;return c().w(function(e){for(;;)switch(e.n){case 0:console.log("Adding ".concat(t," coins to user")),(n=document.querySelector(".coin-balance span"))&&(a=parseInt(n.textContent.replace(/,/g,"")),n.textContent=(a+t).toLocaleString());case 1:return e.a(2)}},e)})),function(e){return a.apply(this,arguments)})},{key:"updateVipStatus",value:(n=l(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:console.log("Upgrading to VIP ".concat(t.name));case 1:return e.a(2)}},e)})),function(e){return n.apply(this,arguments)})},{key:"resetPaymentForm",value:function(){var e;null===(e=document.getElementById("paymentForm"))||void 0===e||e.reset(),document.getElementById("payNowBtn").innerHTML='<i class="fas fa-lock"></i> 立即支付',document.getElementById("payNowBtn").disabled=!0,this.selectedPackage=null,this.discount=0,document.getElementById("promoCode").value="",document.querySelectorAll(".package-card, .vip-card").forEach(function(e){e.style.borderColor=""})}},{key:"formatCardNumber",value:function(e){var t=e.value.replace(/\D/g,"");t=t.replace(/(.{4})/g,"$1 ").trim(),e.value=t.substring(0,19)}},{key:"formatExpiry",value:function(e){var t=e.value.replace(/\D/g,"");t.length>=2&&(t=t.substring(0,2)+"/"+t.substring(2,4)),e.value=t}},{key:"showLoading",value:function(){var e=document.getElementById("pageLoading");e&&e.classList.add("show")}},{key:"hideLoading",value:function(){var e=document.getElementById("pageLoading");e&&e.classList.remove("show")}},{key:"showToast",value:function(e){var t=new CustomEvent("showToast",{detail:{message:e,type:"success"}});document.dispatchEvent(t)}},{key:"showError",value:function(e){var t=new CustomEvent("showToast",{detail:{message:e,type:"error"}});document.dispatchEvent(t)}},{key:"destroy",value:function(){console.log("Payment page destroyed")}}],t&&d(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a,o,r,s,u,p,y}()}}]);