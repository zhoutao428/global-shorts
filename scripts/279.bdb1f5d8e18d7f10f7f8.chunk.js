/*! For license information please see 279.bdb1f5d8e18d7f10f7f8.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkglobalshorts_frontend=self.webpackChunkglobalshorts_frontend||[]).push([[279],{279(e,t,n){function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}n.r(t),n.d(t,{default:()=>pe});const a=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.container=t.dom.controls,this.init()},t=[{key:"init",value:function(){this.createControls(),this.setupEventListeners(),this.updateTimeDisplay()}},{key:"createControls",value:function(){this.container.innerHTML='\n            <div class="controls-left">\n                <button class="control-btn play-pause">\n                    <i class="fas fa-play"></i>\n                    <i class="fas fa-pause"></i>\n                </button>\n                \n                <button class="control-btn prev">\n                    <i class="fas fa-step-backward"></i>\n                </button>\n                \n                <button class="control-btn next">\n                    <i class="fas fa-step-forward"></i>\n                </button>\n                \n                <div class="volume-control">\n                    <button class="control-btn volume">\n                        <i class="fas fa-volume-up"></i>\n                        <i class="fas fa-volume-mute"></i>\n                    </button>\n                    <div class="volume-slider">\n                        <div class="volume-progress"></div>\n                        <input type="range" class="volume-range" min="0" max="1" step="0.01" value="1">\n                    </div>\n                </div>\n                \n                <div class="time-display">\n                    <span class="current-time">00:00</span>\n                    <span class="time-separator">/</span>\n                    <span class="duration">00:00</span>\n                </div>\n            </div>\n            \n            <div class="progress-bar-container">\n                <div class="progress-bar">\n                    <div class="buffered-progress"></div>\n                    <div class="play-progress"></div>\n                    <div class="progress-handle"></div>\n                    <input type="range" class="progress-range" min="0" max="100" step="0.1" value="0">\n                </div>\n            </div>\n            \n            <div class="controls-right">\n                <button class="control-btn subtitle" title="字幕">\n                    <i class="fas fa-closed-captioning"></i>\n                </button>\n                \n                <button class="control-btn quality" title="清晰度">\n                    <i class="fas fa-hd"></i>\n                </button>\n                \n                <button class="control-btn speed" title="播放速度">\n                    <i class="fas fa-running"></i>\n                    <span class="speed-text">1x</span>\n                </button>\n                \n                <button class="control-btn audio-mode" title="听剧模式">\n                    <i class="fas fa-headphones"></i>\n                </button>\n                \n                <button class="control-btn download" title="下载">\n                    <i class="fas fa-download"></i>\n                </button>\n                \n                <button class="control-btn pip" title="画中画">\n                    <i class="fas fa-clone"></i>\n                </button>\n                \n                <button class="control-btn fullscreen">\n                    <i class="fas fa-expand"></i>\n                    <i class="fas fa-compress"></i>\n                </button>\n            </div>\n        ',this.dom={playPause:this.container.querySelector(".play-pause"),prev:this.container.querySelector(".prev"),next:this.container.querySelector(".next"),volume:this.container.querySelector(".volume"),volumeRange:this.container.querySelector(".volume-range"),volumeProgress:this.container.querySelector(".volume-progress"),currentTime:this.container.querySelector(".current-time"),duration:this.container.querySelector(".duration"),progressRange:this.container.querySelector(".progress-range"),playProgress:this.container.querySelector(".play-progress"),bufferedProgress:this.container.querySelector(".buffered-progress"),subtitle:this.container.querySelector(".subtitle"),quality:this.container.querySelector(".quality"),speed:this.container.querySelector(".speed"),speedText:this.container.querySelector(".speed-text"),audioMode:this.container.querySelector(".audio-mode"),download:this.container.querySelector(".download"),pip:this.container.querySelector(".pip"),fullscreen:this.container.querySelector(".fullscreen")}}},{key:"setupEventListeners",value:function(){var e=this;this.dom.playPause.addEventListener("click",function(){return e.player.togglePlay()}),this.dom.prev.addEventListener("click",function(){e.player.trigger("prevEpisode")}),this.dom.next.addEventListener("click",function(){e.player.trigger("nextEpisode")}),this.dom.volume.addEventListener("click",function(){return e.player.toggleMute()}),this.dom.volumeRange.addEventListener("input",function(t){var n=parseFloat(t.target.value);e.player.setVolume(n),e.updateVolumeDisplay(n)}),this.dom.progressRange.addEventListener("input",function(t){var n=parseFloat(t.target.value),i=n/100*e.player.state.duration;e.player.seek(i),e.updateProgressDisplay(n)}),this.dom.subtitle.addEventListener("click",function(){e.player.trigger("showSubtitleMenu")}),this.dom.quality.addEventListener("click",function(){e.player.trigger("showQualityMenu")}),this.dom.speed.addEventListener("click",function(){e.player.trigger("showSpeedMenu")}),this.dom.audioMode.addEventListener("click",function(){e.player.state.isAudioMode?e.player.disableAudioMode():e.player.enableAudioMode()}),this.dom.download.addEventListener("click",function(){return e.player.download()}),this.dom.pip.addEventListener("click",function(){return e.player.togglePictureInPicture()}),this.dom.fullscreen.addEventListener("click",function(){return e.player.toggleFullscreen()}),this.player.on("play",function(){return e.updatePlayState(!0)}),this.player.on("pause",function(){return e.updatePlayState(!1)}),this.player.on("timeupdate",function(){return e.updateTime()}),this.player.on("progress",function(){return e.updateBuffered()}),this.player.on("volumechange",function(){return e.updateVolume()}),this.player.on("ratechange",function(){return e.updatePlaybackRate()}),this.player.on("qualitychange",function(t){return e.updateQuality(t)})}},{key:"updatePlayState",value:function(e){e?this.dom.playPause.classList.add("playing"):this.dom.playPause.classList.remove("playing")}},{key:"updateTime",value:function(){var e=this.player.state.currentTime,t=this.player.state.duration;if(this.dom.currentTime.textContent=this.formatTime(e),this.dom.duration.textContent=this.formatTime(t),t>0){var n=e/t*100;this.updateProgressDisplay(n)}}},{key:"updateBuffered",value:function(){var e=this.player.state.buffered,t=this.player.state.duration;if(t>0){var n=e/t*100;this.dom.bufferedProgress.style.width="".concat(n,"%")}}},{key:"updateProgressDisplay",value:function(e){this.dom.playProgress.style.width="".concat(e,"%"),this.dom.progressRange.value=e}},{key:"updateVolume",value:function(){var e=this.player.state.volume,t=this.player.state.muted;this.dom.volumeRange.value=t?0:e,this.updateVolumeDisplay(t?0:e),t||0===e?this.dom.volume.classList.add("muted"):this.dom.volume.classList.remove("muted")}},{key:"updateVolumeDisplay",value:function(e){this.dom.volumeProgress.style.width="".concat(100*e,"%")}},{key:"updatePlaybackRate",value:function(){var e=this.player.state.playbackRate;this.dom.speedText.textContent="".concat(e,"x")}},{key:"updateQuality",value:function(e){"1080p"===e?this.dom.quality.classList.add("hd"):this.dom.quality.classList.remove("hd")}},{key:"formatTime",value:function(e){if(isNaN(e))return"00:00";var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60);return t>0?"".concat(t,":").concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0")):"".concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"))}},{key:"destroy",value:function(){}}],t&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}var d=u(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t});function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function f(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}var v=f(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t});function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,w(i.key),i)}}function g(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function w(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}var k=g(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t});function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,P(i.key),i)}}function P(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}const L=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.isActive=!1,this.audioElement=null},(t=[{key:"enable",value:function(){var e=this;if(!this.isActive){var t=this.player.el(),n=new Audio;t.querySelectorAll("source").forEach(function(e){var t=document.createElement("source");t.src=e.src,t.type=e.type,n.appendChild(t)}),n.currentTime=this.player.currentTime(),n.play(),t.style.opacity="0",t.style.position="absolute",this.audioElement=n,this.isActive=!0,this.player.pause(),this.player.on("play",function(){e.isActive&&e.audioElement.play()}),this.player.on("pause",function(){e.isActive&&e.audioElement.pause()}),this.setupBackgroundPlayback()}}},{key:"disable",value:function(){if(this.isActive){var e=this.player.el();e.style.opacity="",e.style.position="",this.audioElement&&(this.player.currentTime(this.audioElement.currentTime),this.audioElement.pause(),this.audioElement=null),this.isActive=!1}}},{key:"setupBackgroundPlayback",value:function(){var e=this;document.addEventListener("visibilitychange",function(){document.hidden&&e.isActive&&e.audioElement&&e.audioElement.play()}),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",function(){e.audioElement.play()}),navigator.mediaSession.setActionHandler("pause",function(){e.audioElement.pause()}),navigator.mediaSession.setActionHandler("seekbackward",function(t){e.audioElement.currentTime=Math.max(e.audioElement.currentTime-(t.seekOffset||10),0)}),navigator.mediaSession.setActionHandler("seekforward",function(t){e.audioElement.currentTime=Math.min(e.audioElement.currentTime+(t.seekOffset||10),e.audioElement.duration)}))}}])&&E(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,x(i.key),i)}}function x(e){var t=function(e){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:t+""}var I=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t},(t=[{key:"download",value:function(){}}])&&T(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,D(i.key),i)}}function O(e,t,n){return t&&M(e.prototype,t),n&&M(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function D(e){var t=function(e){if("object"!=q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==q(t)?t:t+""}var C=O(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t});function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,A(i.key),i)}}function F(e,t,n){return t&&V(e.prototype,t),n&&V(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function A(e){var t=function(e){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==B(t)?t:t+""}var R=F(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t});function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_(i.key),i)}}function H(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}var G=H(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t});function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,W(i.key),i)}}function W(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}var K=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.container=n},(t=[{key:"send",value:function(e){}}])&&z(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function X(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function r(n,i,o,r){var l=i&&i.prototype instanceof s?i:s,u=Object.create(l.prototype);return Y(u,"_invoke",function(n,i,o){var r,s,l,u=0,c=o||[],d=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,n){return r=t,s=0,l=e,p.n=n,a}};function y(n,i){for(s=n,l=i,t=0;!d&&u&&!o&&t<c.length;t++){var o,r=c[t],y=p.p,f=r[2];n>3?(o=f===i)&&(l=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=y&&((o=n<2&&y<r[1])?(s=0,p.v=i,p.n=r[1]):y<f&&(o=n<3||r[0]>i||i>f)&&(r[4]=n,r[5]=i,p.n=f,s=0))}if(o||n>1)return a;throw d=!0,i}return function(o,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&y(c,f),s=c,l=f;(t=s<2?e:l)||!d;){r||(s?s<3?(s>1&&(p.n=-1),y(s,l)):p.n=l:p.v=l);try{if(u=2,r){if(s||(o="next"),t=r[o]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);r=e}else if((t=(d=p.n<0)?l:n.call(i,p))!==a)break}catch(t){r=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,o,r),!0),u}var a={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][i]?t(t([][i]())):(Y(t={},i,function(){return this}),t),d=u.prototype=s.prototype=Object.create(c);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Y(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,Y(d,"constructor",u),Y(u,"constructor",l),l.displayName="GeneratorFunction",Y(u,o,"GeneratorFunction"),Y(d),Y(d,o,"Generator"),Y(d,i,function(){return this}),Y(d,"toString",function(){return"[object Generator]"}),(X=function(){return{w:r,m:p}})()}function Y(e,t,n,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Y=function(e,t,n,i){function r(t,n){Y(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},Y(e,t,n,i)}function Z(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ee(e,t,n){return(t=ne(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ne(i.key),i)}}function ne(e){var t=function(e){if("object"!=J(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==J(t)?t:t+""}var ie=function(){return e=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container="string"==typeof t?document.getElementById(t):t,!this.container)throw new Error("Video player container not found");this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach(function(t){ee(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({autoplay:!1,controls:!0,muted:!1,loop:!1,poster:"",sources:[],subtitles:[],playbackRates:[.5,.75,1,1.25,1.5,2],defaultPlaybackRate:1,defaultQuality:"auto",defaultSubtitle:null,enableDanmaku:!1,enableDownload:!0,enablePictureInPicture:!0,enableKeyboard:!0,enableProgressPreview:!0,theme:"dark"},n),this.state={isPlaying:!1,currentTime:0,duration:0,volume:1,muted:this.options.muted,playbackRate:this.options.defaultPlaybackRate,currentQuality:this.options.defaultQuality,currentSubtitle:this.options.defaultSubtitle,buffered:0,isFullscreen:!1,isPiP:!1,isAudioMode:!1,isLoading:!0,error:null},this.components={},this.events={},this.init()},t=[{key:"init",value:function(){this.createDOM(),this.createVideoElement(),this.loadSources(),this.initComponents(),this.setupEventListeners(),this.applyInitialSettings()}},{key:"createDOM",value:function(){this.container.innerHTML="",this.container.classList.add("global-shorts-player"),this.container.classList.add("theme-".concat(this.options.theme)),this.container.innerHTML='\n            <div class="player-container">\n                <div class="player-video-wrapper">\n                    <video class="player-video" playsinline webkit-playsinline x5-playsinline></video>\n                    \n                    \x3c!-- 弹幕容器 --\x3e\n                    <div class="player-danmaku"></div>\n                    \n                    \x3c!-- 加载动画 --\x3e\n                    <div class="player-loading">\n                        <div class="loading-spinner"></div>\n                    </div>\n                    \n                    \x3c!-- 错误提示 --\x3e\n                    <div class="player-error">\n                        <i class="fas fa-exclamation-circle"></i>\n                        <p></p>\n                    </div>\n                    \n                    \x3c!-- 大播放按钮 --\x3e\n                    <div class="player-big-play-btn">\n                        <i class="fas fa-play"></i>\n                    </div>\n                    \n                    \x3c!-- 控制栏容器 --\x3e\n                    <div class="player-controls"></div>\n                    \n                    \x3c!-- 进度预览容器 --\x3e\n                    <div class="player-preview"></div>\n                </div>\n                \n                \x3c!-- 清晰度菜单 --\x3e\n                <div class="player-quality-menu"></div>\n                \n                \x3c!-- 字幕菜单 --\x3e\n                <div class="player-subtitle-menu"></div>\n                \n                \x3c!-- 播放速度菜单 --\x3e\n                <div class="player-speed-menu"></div>\n            </div>\n        ',this.dom={wrapper:this.container.querySelector(".player-video-wrapper"),videoWrapper:this.container.querySelector(".player-video-wrapper"),video:this.container.querySelector(".player-video"),danmaku:this.container.querySelector(".player-danmaku"),loading:this.container.querySelector(".player-loading"),error:this.container.querySelector(".player-error"),errorMsg:this.container.querySelector(".player-error p"),bigPlayBtn:this.container.querySelector(".player-big-play-btn"),controls:this.container.querySelector(".player-controls"),preview:this.container.querySelector(".player-preview"),qualityMenu:this.container.querySelector(".player-quality-menu"),subtitleMenu:this.container.querySelector(".player-subtitle-menu"),speedMenu:this.container.querySelector(".player-speed-menu")}}},{key:"createVideoElement",value:function(){var e=this;this.video=this.dom.video,this.options.poster&&(this.video.poster=this.options.poster),this.video.muted=this.options.muted,this.video.loop=this.options.loop,this.video.preload="auto",this.video.addEventListener("loadstart",function(){return e.handleEvent("loadstart")}),this.video.addEventListener("loadedmetadata",function(){return e.handleEvent("loadedmetadata")}),this.video.addEventListener("loadeddata",function(){return e.handleEvent("loadeddata")}),this.video.addEventListener("canplay",function(){return e.handleEvent("canplay")}),this.video.addEventListener("canplaythrough",function(){return e.handleEvent("canplaythrough")}),this.video.addEventListener("play",function(){return e.handleEvent("play")}),this.video.addEventListener("playing",function(){return e.handleEvent("playing")}),this.video.addEventListener("pause",function(){return e.handleEvent("pause")}),this.video.addEventListener("ended",function(){return e.handleEvent("ended")}),this.video.addEventListener("waiting",function(){return e.handleEvent("waiting")}),this.video.addEventListener("stalled",function(){return e.handleEvent("stalled")}),this.video.addEventListener("seeking",function(){return e.handleEvent("seeking")}),this.video.addEventListener("seeked",function(){return e.handleEvent("seeked")}),this.video.addEventListener("timeupdate",function(){return e.handleEvent("timeupdate")}),this.video.addEventListener("volumechange",function(){return e.handleEvent("volumechange")}),this.video.addEventListener("ratechange",function(){return e.handleEvent("ratechange")}),this.video.addEventListener("durationchange",function(){return e.handleEvent("durationchange")}),this.video.addEventListener("progress",function(){return e.handleEvent("progress")}),this.video.addEventListener("error",function(t){return e.handleError(t)})}},{key:"initComponents",value:function(){this.components.controls=new a(this),this.options.sources.length>0&&(this.components.qualitySelector=new d(this)),this.options.subtitles.length>0&&(this.components.subtitleManager=new v(this)),this.components.playbackRate=new k(this),this.components.audioMode=new L(this),this.options.enableDownload&&(this.components.downloadManager=new I(this)),this.options.enableKeyboard&&(this.components.keyboardShortcuts=new C(this)),this.options.enablePictureInPicture&&document.pictureInPictureEnabled&&(this.components.pictureInPicture=new R(this)),this.options.enableProgressPreview&&(this.components.progressPreview=new G(this)),this.options.enableDanmaku&&(this.components.danmaku=new K(this,this.dom.danmaku))}},{key:"setupEventListeners",value:function(){var e,t=this;this.dom.bigPlayBtn.addEventListener("click",function(){return t.togglePlay()}),this.dom.videoWrapper.addEventListener("click",function(e){e.target.closest(".player-controls")||e.target.closest(".player-quality-menu")||t.togglePlay()}),this.dom.wrapper.addEventListener("mousemove",function(){t.showControls(),clearTimeout(e),e=setTimeout(function(){t.state.isPlaying&&!t.state.isAudioMode&&t.hideControls()},3e3)}),this.dom.wrapper.addEventListener("mouseleave",function(){t.state.isPlaying&&!t.state.isAudioMode&&t.hideControls()})}},{key:"applyInitialSettings",value:function(){this.setPlaybackRate(this.options.defaultPlaybackRate),this.options.defaultSubtitle&&this.setSubtitle(this.options.defaultSubtitle)}},{key:"loadSources",value:function(){var e=this;if(0!==this.options.sources.length){for(;this.video.firstChild;)this.video.removeChild(this.video.firstChild);this.options.sources.forEach(function(t){var n=document.createElement("source");n.src=t.url,n.type=t.type||"video/mp4",t.quality&&n.setAttribute("data-quality",t.quality),e.video.appendChild(n)}),this.video.load()}}},{key:"handleEvent",value:function(e){switch(e){case"loadedmetadata":this.state.duration=this.video.duration,this.state.isLoading=!1;break;case"timeupdate":this.state.currentTime=this.video.currentTime;break;case"progress":this.video.buffered.length>0&&(this.state.buffered=this.video.buffered.end(this.video.buffered.length-1));break;case"waiting":this.showLoading();break;case"canplay":case"playing":this.hideLoading();break;case"play":this.state.isPlaying=!0,this.dom.bigPlayBtn.classList.add("hidden"),this.container.classList.add("playing");break;case"pause":this.state.isPlaying=!1,this.dom.bigPlayBtn.classList.remove("hidden"),this.container.classList.remove("playing");break;case"volumechange":this.state.volume=this.video.volume,this.state.muted=this.video.muted;break;case"ratechange":this.state.playbackRate=this.video.playbackRate}this.trigger(e,this.state)}},{key:"handleError",value:function(e){var t=this.video.error;this.state.error=t,this.state.isLoading=!1,this.dom.error.classList.add("show");var n="视频加载失败";if(t)switch(t.code){case 1:n="视频加载被中止";break;case 2:n="网络错误导致视频下载失败";break;case 3:n="视频解码失败";break;case 4:n="视频格式不支持"}this.dom.errorMsg.textContent=n,this.trigger("error",{error:t,message:n})}},{key:"showLoading",value:function(){this.dom.loading.classList.add("show")}},{key:"hideLoading",value:function(){this.dom.loading.classList.remove("show")}},{key:"showControls",value:function(){this.dom.controls.classList.add("show"),this.dom.wrapper.style.cursor="default"}},{key:"hideControls",value:function(){this.dom.controls.classList.remove("show"),this.dom.wrapper.style.cursor="none"}},{key:"play",value:function(){var e=this,t=this.video.play();void 0!==t&&t.catch(function(t){console.error("Play failed:",t),e.handleError({target:{error:t}})})}},{key:"pause",value:function(){this.video.pause()}},{key:"togglePlay",value:function(){this.video.paused?this.play():this.pause()}},{key:"seek",value:function(e){this.video.currentTime=Math.max(0,Math.min(e,this.state.duration))}},{key:"setVolume",value:function(e){this.video.volume=Math.max(0,Math.min(1,e))}},{key:"toggleMute",value:function(){this.video.muted=!this.video.muted}},{key:"setPlaybackRate",value:function(e){this.video.playbackRate=e}},{key:"toggleFullscreen",value:function(){document.fullscreenElement?(document.exitFullscreen(),this.state.isFullscreen=!1):(this.dom.wrapper.requestFullscreen(),this.state.isFullscreen=!0)}},{key:"togglePictureInPicture",value:(n=X().m(function e(){var t;return X().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!document.pictureInPictureElement){e.n=2;break}return e.n=1,document.exitPictureInPicture();case 1:this.state.isPiP=!1,e.n=4;break;case 2:return e.n=3,this.video.requestPictureInPicture();case 3:this.state.isPiP=!0;case 4:e.n=6;break;case 5:e.p=5,t=e.v,console.error("Picture-in-Picture failed:",t);case 6:return e.a(2)}},e,this,[[0,5]])}),i=function(){var e=this,t=arguments;return new Promise(function(i,o){var r=n.apply(e,t);function a(e){Z(r,i,o,a,s,"next",e)}function s(e){Z(r,i,o,a,s,"throw",e)}a(void 0)})},function(){return i.apply(this,arguments)})},{key:"setQuality",value:function(e){var t=this.options.sources.find(function(t){return t.quality===e});t&&(this.state.currentQuality=e,this.video.src=t.url,this.video.load(),this.state.isPlaying&&this.video.play(),this.trigger("qualitychange",e))}},{key:"setSubtitle",value:function(e){this.components.subtitleManager&&this.components.subtitleManager.setSubtitle(e)}},{key:"enableAudioMode",value:function(){this.components.audioMode&&this.components.audioMode.enable()}},{key:"disableAudioMode",value:function(){this.components.audioMode&&this.components.audioMode.disable()}},{key:"download",value:function(){this.components.downloadManager&&this.components.downloadManager.download()}},{key:"sendDanmaku",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.components.danmaku&&this.components.danmaku.send(e,t)}},{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"off",value:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(function(e){return e!==t}))}},{key:"trigger",value:function(e,t){this.events[e]&&this.events[e].forEach(function(e){return e(t)})}},{key:"destroy",value:function(){this.pause(),Object.values(this.components).forEach(function(e){e&&"function"==typeof e.destroy&&e.destroy()}),this.events={},this.container.innerHTML="",this.container.classList.remove("global-shorts-player","theme-".concat(this.options.theme))}}],t&&te(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i}();const oe=ie;function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function ae(){var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function r(n,i,o,r){var l=i&&i.prototype instanceof s?i:s,u=Object.create(l.prototype);return se(u,"_invoke",function(n,i,o){var r,s,l,u=0,c=o||[],d=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,n){return r=t,s=0,l=e,p.n=n,a}};function y(n,i){for(s=n,l=i,t=0;!d&&u&&!o&&t<c.length;t++){var o,r=c[t],y=p.p,f=r[2];n>3?(o=f===i)&&(l=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=y&&((o=n<2&&y<r[1])?(s=0,p.v=i,p.n=r[1]):y<f&&(o=n<3||r[0]>i||i>f)&&(r[4]=n,r[5]=i,p.n=f,s=0))}if(o||n>1)return a;throw d=!0,i}return function(o,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&y(c,f),s=c,l=f;(t=s<2?e:l)||!d;){r||(s?s<3?(s>1&&(p.n=-1),y(s,l)):p.n=l:p.v=l);try{if(u=2,r){if(s||(o="next"),t=r[o]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);r=e}else if((t=(d=p.n<0)?l:n.call(i,p))!==a)break}catch(t){r=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,o,r),!0),u}var a={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][i]?t(t([][i]())):(se(t={},i,function(){return this}),t),d=u.prototype=s.prototype=Object.create(c);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,se(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,se(d,"constructor",u),se(u,"constructor",l),l.displayName="GeneratorFunction",se(u,o,"GeneratorFunction"),se(d),se(d,o,"Generator"),se(d,i,function(){return this}),se(d,"toString",function(){return"[object Generator]"}),(ae=function(){return{w:r,m:p}})()}function se(e,t,n,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}se=function(e,t,n,i){function r(t,n){se(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},se(e,t,n,i)}function le(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function ue(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var r=e.apply(t,n);function a(e){le(r,i,o,a,s,"next",e)}function s(e){le(r,i,o,a,s,"throw",e)}a(void 0)})}}function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,de(i.key),i)}}function de(e){var t=function(e){if("object"!=re(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==re(t)?t:t+""}var pe=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.dramaId=t.id||this.getQueryParam("drama"),this.episodeId=parseInt(this.getQueryParam("episode"))||1,this.dramaData=null,this.episodeData=null,this.player=null,this.isLoading=!1,this.init()},t=[{key:"init",value:(o=ue(ae().m(function e(){return ae().w(function(e){for(;;)switch(e.n){case 0:return console.log("Player page initialized",{dramaId:this.dramaId,episodeId:this.episodeId}),this.showLoading(),e.n=1,this.loadDramaData();case 1:this.updatePageInfo(),this.initPlayer(),this.loadEpisodeList(),this.bindEvents(),this.hideLoading(),this.initWatchHistory();case 2:return e.a(2)}},e,this)})),function(){return o.apply(this,arguments)})},{key:"getQueryParam",value:function(e){return new URLSearchParams(window.location.search).get(e)}},{key:"loadDramaData",value:(i=ue(ae().m(function e(){var t=this;return ae().w(function(e){for(;;)switch(e.n){case 0:try{this.dramaData={id:this.dramaId,title:"总裁的秘密婚姻",coverImage:"/images/drama-cover.jpg",episodes:[{id:1,number:1,title:"意外的相遇",duration:340,videoUrl:"https://example.com/video1.mp4",thumbnail:"/images/ep1-thumb.jpg",isVip:!1,watched:!0},{id:2,number:2,title:"契约的开始",duration:365,videoUrl:"https://example.com/video2.mp4",thumbnail:"/images/ep2-thumb.jpg",isVip:!1,watched:!1},{id:3,number:3,title:"心动的瞬间",duration:352,videoUrl:"https://example.com/video3.mp4",thumbnail:"/images/ep3-thumb.jpg",isVip:!0,watched:!1},{id:4,number:4,title:"误会与和解",duration:378,videoUrl:"https://example.com/video4.mp4",thumbnail:"/images/ep4-thumb.jpg",isVip:!0,watched:!1},{id:5,number:5,title:"真心的告白",duration:395,videoUrl:"https://example.com/video5.mp4",thumbnail:"/images/ep5-thumb.jpg",isVip:!0,watched:!1}]},this.episodeData=this.dramaData.episodes.find(function(e){return e.number===t.episodeId})||this.dramaData.episodes[0]}catch(e){console.error("Failed to load drama data:",e),this.showError("剧集加载失败")}case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"updatePageInfo",value:function(){document.querySelector(".drama-title").textContent=this.dramaData.title,document.querySelector(".current-episode-title").textContent="第".concat(this.episodeData.number,"集 ").concat(this.episodeData.title),document.querySelector(".episode-description").textContent="这里是剧集描述，将会从API获取实际内容。"}},{key:"initPlayer",value:function(){var e=document.getElementById("player-container");if(e){var t=this.buildSources(),n=this.buildSubtitles();this.player=new oe(e,{sources:t,subtitles:n,poster:this.episodeData.thumbnail||"/images/poster.jpg",autoplay:!0,enableDanmaku:!0,enableDownload:!0,enablePictureInPicture:!0,defaultPlaybackRate:1,theme:"dark"}),this.setupPlayerEvents()}}},{key:"buildSources",value:function(){return[{url:this.episodeData.videoUrl,quality:"1080p",type:"video/mp4",label:"1080p",selected:!0},{url:this.episodeData.videoUrl.replace(".mp4","_720p.mp4"),quality:"720p",type:"video/mp4",label:"720p"},{url:this.episodeData.videoUrl.replace(".mp4","_480p.mp4"),quality:"480p",type:"video/mp4",label:"480p"}]}},{key:"buildSubtitles",value:function(){return[{url:"/subtitles/en.vtt",lang:"en",label:"English",default:!0},{url:"/subtitles/zh.vtt",lang:"zh",label:"中文"},{url:"/subtitles/es.vtt",lang:"es",label:"Español"}]}},{key:"setupPlayerEvents",value:function(){var e=this;this.player&&(this.player.on("prevEpisode",function(){e.switchEpisode(e.episodeId-1)}),this.player.on("nextEpisode",function(){e.switchEpisode(e.episodeId+1)}),this.player.on("showSubtitleMenu",function(){e.toggleSubtitleMenu()}),this.player.on("showQualityMenu",function(){e.toggleQualityMenu()}),this.player.on("showSpeedMenu",function(){e.toggleSpeedMenu()}),this.player.on("ended",function(){e.episodeId<e.dramaData.episodes.length&&e.showNextEpisodePrompt()}),this.player.on("error",function(t){console.error("Player error:",t),e.showError("播放出错，请重试")}))}},{key:"loadEpisodeList",value:function(){var e=this,t=document.getElementById("episode-list");t&&(t.innerHTML="",this.dramaData.episodes.forEach(function(n){var i=document.createElement("div");i.className="episode-item",n.number===e.episodeId&&i.classList.add("active"),n.isVip&&!e.isVIP()&&i.classList.add("locked"),i.innerHTML='\n                <div class="episode-number">'.concat(n.number,'</div>\n                <div class="episode-info">\n                    <div class="episode-title">').concat(n.title,'</div>\n                    <div class="episode-duration">').concat(e.formatDuration(n.duration),"</div>\n                </div>\n                ").concat(n.watched?'<div class="watched-badge">已观看</div>':"","\n                ").concat(n.isVip?'<i class="fas fa-crown vip-icon"></i>':"","\n            "),i.addEventListener("click",function(){n.isVip&&!e.isVIP()?e.showVIPPrompt():e.switchEpisode(n.number)}),t.appendChild(i)}))}},{key:"switchEpisode",value:function(e){if(e!==this.episodeId&&this.dramaData.episodes.find(function(t){return t.number===e})){var t=new URL(window.location);t.searchParams.set("episode",e),window.history.pushState({},"",t),window.location.reload()}}},{key:"toggleSubtitleMenu",value:function(){var e,t,n=document.querySelector(".player-subtitle-menu");n&&(n.classList.contains("show")?n.classList.remove("show"):(null===(e=document.querySelector(".player-quality-menu"))||void 0===e||e.classList.remove("show"),null===(t=document.querySelector(".player-speed-menu"))||void 0===t||t.classList.remove("show"),this.buildSubtitleMenu(n),n.classList.add("show")))}},{key:"buildSubtitleMenu",value:function(e){var t=this;e.innerHTML="";var n=document.createElement("div");n.className="menu-item",n.textContent="关闭字幕",n.addEventListener("click",function(){t.player&&t.player.setSubtitle(null),e.classList.remove("show")}),e.appendChild(n),[{lang:"en",label:"English"},{lang:"zh",label:"中文"},{lang:"es",label:"Español"}].forEach(function(n){var i=document.createElement("div");i.className="menu-item",i.textContent=n.label,i.addEventListener("click",function(){t.player&&t.player.setSubtitle(n.lang),e.classList.remove("show")}),e.appendChild(i)})}},{key:"toggleQualityMenu",value:function(){var e,t,n=document.querySelector(".player-quality-menu");n&&(n.classList.contains("show")?n.classList.remove("show"):(null===(e=document.querySelector(".player-subtitle-menu"))||void 0===e||e.classList.remove("show"),null===(t=document.querySelector(".player-speed-menu"))||void 0===t||t.classList.remove("show"),this.buildQualityMenu(n),n.classList.add("show")))}},{key:"buildQualityMenu",value:function(e){var t=this;e.innerHTML="",["1080p","720p","480p","360p"].forEach(function(n){var i=document.createElement("div");i.className="menu-item",i.textContent=n,i.addEventListener("click",function(){t.player&&t.player.setQuality(n),e.classList.remove("show")}),e.appendChild(i)})}},{key:"toggleSpeedMenu",value:function(){var e,t,n=document.querySelector(".player-speed-menu");n&&(n.classList.contains("show")?n.classList.remove("show"):(null===(e=document.querySelector(".player-quality-menu"))||void 0===e||e.classList.remove("show"),null===(t=document.querySelector(".player-subtitle-menu"))||void 0===t||t.classList.remove("show"),this.buildSpeedMenu(n),n.classList.add("show")))}},{key:"buildSpeedMenu",value:function(e){var t=this;e.innerHTML="",[.5,.75,1,1.25,1.5,2].forEach(function(n){var i=document.createElement("div");i.className="menu-item",i.textContent="".concat(n,"x"),i.addEventListener("click",function(){t.player&&t.player.setPlaybackRate(n),e.classList.remove("show")}),e.appendChild(i)})}},{key:"isVIP",value:function(){return window.auth&&window.auth.isVIP()}},{key:"showVIPPrompt",value:function(){confirm("该剧集为VIP专属，是否开通VIP会员？")&&window.router.navigate("/payment",{vip:!0})}},{key:"showNextEpisodePrompt",value:function(){var e,t,n=this,i=this.dramaData.episodes[this.episodeId];if(i&&(!i.isVip||this.isVIP())){var o=document.createElement("div");o.className="next-episode-prompt",o.innerHTML='\n            <div class="prompt-content">\n                <p>即将播放下一集: '.concat(i.title,'</p>\n                <div class="prompt-actions">\n                    <button class="btn-secondary" id="cancelNext">取消</button>\n                    <button class="btn-primary" id="playNext">播放</button>\n                </div>\n            </div>\n        '),document.querySelector(".player-container").appendChild(o),null===(e=document.getElementById("playNext"))||void 0===e||e.addEventListener("click",function(){n.switchEpisode(n.episodeId+1)}),null===(t=document.getElementById("cancelNext"))||void 0===t||t.addEventListener("click",function(){o.remove()}),setTimeout(function(){o.parentNode&&o.remove()},5e3)}}},{key:"initWatchHistory",value:function(){var e=this;if(window.auth.isLoggedIn()){var t=0;this.player&&this.player.on("timeupdate",function(){var n=e.player.state.currentTime;n-t>=30&&(t=n,e.saveWatchProgress(n))})}}},{key:"saveWatchProgress",value:(n=ue(ae().m(function e(t){var n;return ae().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/watch-history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({dramaId:this.dramaId,episodeId:this.episodeId,progress:t,total:this.episodeData.duration})});case 1:e.n=3;break;case 2:e.p=2,n=e.v,console.error("Failed to save watch progress:",n);case 3:return e.a(2)}},e,this,[[0,2]])})),function(e){return n.apply(this,arguments)})},{key:"formatDuration",value:function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60);return t>0?"".concat(t,":").concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0")):"".concat(n,":").concat(i.toString().padStart(2,"0"))}},{key:"bindEvents",value:function(){var e,t,n,i,o,r,a,s=this;null===(e=document.getElementById("backBtn"))||void 0===e||e.addEventListener("click",function(){window.history.back()}),null===(t=document.getElementById("shareBtn"))||void 0===t||t.addEventListener("click",function(){s.handleShare()}),null===(n=document.getElementById("downloadBtn"))||void 0===n||n.addEventListener("click",function(){s.handleDownload()}),null===(i=document.getElementById("likeBtn"))||void 0===i||i.addEventListener("click",function(){s.handleLike()}),null===(o=document.getElementById("favoriteBtn"))||void 0===o||o.addEventListener("click",function(){s.handleFavorite()}),null===(r=document.getElementById("sendDanmaku"))||void 0===r||r.addEventListener("click",function(){s.sendDanmaku()}),null===(a=document.getElementById("danmakuInput"))||void 0===a||a.addEventListener("keypress",function(e){"Enter"===e.key&&s.sendDanmaku()})}},{key:"handleShare",value:function(){var e=this;navigator.share?navigator.share({title:"".concat(this.dramaData.title," 第").concat(this.episodeId,"集"),url:window.location.href}).catch(console.error):navigator.clipboard.writeText(window.location.href).then(function(){return e.showToast("链接已复制")}).catch(console.error)}},{key:"handleDownload",value:function(){window.auth.isLoggedIn()?!this.episodeData.isVip||this.isVIP()?this.showToast("下载功能开发中"):this.showVIPPrompt():window.router.navigate("/login",{redirect:"player"})}},{key:"handleLike",value:function(){if(window.auth.isLoggedIn()){var e=document.getElementById("likeBtn");e.classList.toggle("active");var t=e.querySelector("span");if(t){var n=parseInt(t.textContent.replace("K",""));e.classList.contains("active")?(n++,t.textContent=n>1e3?(n/1e3).toFixed(1)+"K":n):(n--,t.textContent=n>1e3?(n/1e3).toFixed(1)+"K":n)}}else window.router.navigate("/login",{redirect:"player"})}},{key:"handleFavorite",value:function(){if(window.auth.isLoggedIn()){var e=document.getElementById("favoriteBtn");e.classList.toggle("active");var t=e.classList.contains("active")?"已添加到收藏":"已取消收藏";this.showToast(t)}else window.router.navigate("/login",{redirect:"player"})}},{key:"sendDanmaku",value:function(){var e=document.getElementById("danmakuInput"),t=e.value.trim();t&&this.player&&this.player.sendDanmaku&&(this.player.sendDanmaku(t,{color:"#FFFFFF",size:25,position:"scroll"}),e.value="")}},{key:"showLoading",value:function(){var e=document.getElementById("pageLoading");e&&e.classList.add("show")}},{key:"hideLoading",value:function(){var e=document.getElementById("pageLoading");e&&e.classList.remove("show")}},{key:"showToast",value:function(e){var t=new CustomEvent("showToast",{detail:{message:e,type:"success"}});document.dispatchEvent(t)}},{key:"showError",value:function(e){var t=new CustomEvent("showToast",{detail:{message:e,type:"error"}});document.dispatchEvent(t)}},{key:"destroy",value:function(){console.log("Player page destroyed"),this.player&&this.player.destroy&&this.player.destroy()}}],t&&ce(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i,o}()}}]);