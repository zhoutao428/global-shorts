/*! For license information please see 667.ea34519094a71370ff36.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkglobalshorts_frontend=self.webpackChunkglobalshorts_frontend||[]).push([[667],{667(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function c(n,r,o,i){var c=r&&r.prototype instanceof u?r:u,d=Object.create(c.prototype);return a(d,"_invoke",function(n,r,o){var a,i,c,u=0,d=o||[],l=!1,f={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(e,n){return a=e,i=0,c=t,f.n=n,s}};function v(n,r){for(i=n,c=r,e=0;!l&&u&&!o&&e<d.length;e++){var o,a=d[e],v=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=v&&((o=n<2&&v<a[1])?(i=0,f.v=r,f.n=a[1]):v<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return s;throw l=!0,r}return function(o,d,g){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&v(d,g),i=d,c=g;(e=i<2?t:c)||!l;){a||(i?i<3?(i>1&&(f.n=-1),v(i,c)):f.n=c:f.v=c);try{if(u=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(l=f.n<0)?c:n.call(r,f))!==s)break}catch(e){a=t,i=1,c=e}finally{u=1}}return{value:e,done:l}}}(n,o,i),!0),d}var s={};function u(){}function d(){}function l(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(a(e={},r,function(){return this}),e),v=l.prototype=u.prototype=Object.create(f);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,a(t,i,"GeneratorFunction")),t.prototype=Object.create(v),t}return d.prototype=l,a(v,"constructor",l),a(l,"constructor",d),d.displayName="GeneratorFunction",a(l,i,"GeneratorFunction"),a(v),a(v,i,"Generator"),a(v,r,function(){return this}),a(v,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:g}})()}function a(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,n,r){function i(e,n){a(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},a(t,e,n,r)}function i(t,e,n,r,o,a,i){try{var c=t[a](i),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,o)}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function s(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}n.r(e),n.d(e,{default:()=>u});var u=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,this.currentTab="recommended",this.currentCategory="all",this.page=1,this.isLoading=!1,this.hasMore=!0,this.init()},e=[{key:"init",value:function(){console.log("Discover page initialized",this.params),this.initTabs(),this.initCategories(),this.initInfiniteScroll(),this.loadContent(),this.bindEvents()}},{key:"initTabs",value:function(){var t=this,e=document.querySelectorAll(".discover-tab");e.forEach(function(n){n.addEventListener("click",function(){var r=n.dataset.tab;e.forEach(function(t){return t.classList.remove("active")}),n.classList.add("active"),t.currentTab=r,t.page=1,t.hasMore=!0,document.getElementById("contentGrid").innerHTML="",t.loadContent()})})}},{key:"initCategories",value:function(){var t=this,e=document.querySelectorAll(".category-chip");e.forEach(function(n){n.addEventListener("click",function(){var r=n.dataset.category;e.forEach(function(t){return t.classList.remove("active")}),n.classList.add("active"),t.currentCategory=r,t.page=1,t.hasMore=!0,document.getElementById("contentGrid").innerHTML="",t.loadContent()})})}},{key:"initInfiniteScroll",value:function(){var t=this,e=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&!t.isLoading&&t.hasMore&&(t.page++,t.loadContent())})},{root:null,rootMargin:"0px",threshold:.1}),n=document.getElementById("loadMoreTrigger");n&&e.observe(n)}},{key:"loadContent",value:(n=o().m(function t(){var e,n,r,a;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isLoading&&this.hasMore){t.n=1;break}return t.a(2);case 1:return this.isLoading=!0,this.showLoading(),t.p=2,e=new URLSearchParams({page:this.page,limit:20,tab:this.currentTab,category:"all"!==this.currentCategory?this.currentCategory:""}),t.n=3,fetch("/api/discover?".concat(e));case 3:return n=t.v,t.n=4,n.json();case 4:(r=t.v).success&&(this.renderContent(r.data),this.hasMore=r.pagination.page<r.pagination.pages),t.n=6;break;case 5:t.p=5,a=t.v,console.error("Failed to load content:",a),this.showError("Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑ÈáçËØï");case 6:return t.p=6,this.isLoading=!1,this.hideLoading(),t.f(6);case 7:return t.a(2)}},t,this,[[2,5,6,7]])}),r=function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function c(t){i(a,r,o,c,s,"next",t)}function s(t){i(a,r,o,c,s,"throw",t)}c(void 0)})},function(){return r.apply(this,arguments)})},{key:"renderContent",value:function(t){var e=this,n=document.getElementById("contentGrid");t.forEach(function(t){var r=e.createContentCard(t);n.appendChild(r)}),this.updateLoadMoreTrigger()}},{key:"createContentCard",value:function(t){var e=document.createElement("div");return e.className="content-card",e.dataset.id=t.id,e.innerHTML='\n            <div class="card-thumbnail">\n                <img src="'.concat(t.coverImage||"/images/placeholder.jpg",'" alt="').concat(t.title,'">\n                <div class="card-badges">\n                    ').concat(t.isHot?'<div class="badge hot">HOT</div>':"","\n                    ").concat(t.isNew?'<div class="badge new">NEW</div>':"","\n                    ").concat(t.rating?'<div class="badge rating">‚≠ê '.concat(t.rating,"</div>"):"",'\n                </div>\n                <div class="card-overlay">\n                    <button class="play-btn" onclick="event.stopPropagation()">\n                        <i class="fas fa-play"></i>\n                    </button>\n                </div>\n            </div>\n            <div class="card-info">\n                <h3 class="card-title">').concat(t.title,'</h3>\n                <div class="card-meta">\n                    <span class="category">').concat(this.getCategoryName(t.category),'</span>\n                    <span class="views">üëÅ ').concat(this.formatViews(t.viewCount),'</span>\n                </div>\n                <p class="card-description">').concat(t.description||"",'</p>\n                <div class="card-tags">\n                    ').concat(t.tags?t.tags.map(function(t){return'<span class="tag">#'.concat(t,"</span>")}).join(""):"","\n                </div>\n            </div>\n        "),e.addEventListener("click",function(){window.router.navigate("/player/".concat(t.id))}),e.querySelector(".play-btn").addEventListener("click",function(e){e.stopPropagation(),window.router.navigate("/player/".concat(t.id))}),e}},{key:"getCategoryName",value:function(t){return{romance:"Áà±ÊÉÖ",ceo:"ÊÄªË£Å",fantasy:"ÁéÑÂπª",suspense:"ÊÇ¨Áñë",comedy:"ÂñúÂâß",action:"Âä®‰Ωú",historical:"Âè§Ë£Ö"}[t]||t}},{key:"formatViews",value:function(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}},{key:"updateLoadMoreTrigger",value:function(){var t=document.getElementById("loadMoreTrigger");t||((t=document.createElement("div")).id="loadMoreTrigger",t.className="load-more-trigger",document.getElementById("contentGrid").after(t)),this.hasMore?t.innerHTML="":t.innerHTML='<p class="end-message">Ê≤°ÊúâÊõ¥Â§ö‰∫Ü</p>'}},{key:"showLoading",value:function(){var t=document.getElementById("contentLoading");t&&t.classList.add("show")}},{key:"hideLoading",value:function(){var t=document.getElementById("contentLoading");t&&t.classList.remove("show")}},{key:"showError",value:function(t){var e=new CustomEvent("showToast",{detail:{message:t,type:"error"}});document.dispatchEvent(e)}},{key:"bindEvents",value:function(){var t=document.getElementById("discoverSearch"),e=document.getElementById("searchBtn");if(t&&e){var n=function(){var e=t.value.trim();e&&window.router.navigate("/search",{q:e})};e.addEventListener("click",n),t.addEventListener("keypress",function(t){"Enter"===t.key&&n()})}document.querySelectorAll(".trending-tag").forEach(function(t){t.addEventListener("click",function(){var e=t.textContent.replace("#","");window.router.navigate("/search",{q:e})})})}},{key:"destroy",value:function(){console.log("Discover page destroyed")}}],e&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}()}}]);